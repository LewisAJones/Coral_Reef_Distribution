#prepare modern occurrence data
#load libraries
library(dplyr)
library(raster)
source("./R/options.R")

#load data
data <- read.csv("./data/occurrences/ReefBase_24_08_2021.csv")
#remove non-reef coral community data
remove <- c("",
              "Non-reef coral community",
              "Non-Reef coral community",
              "Non-Reef Coral Community",
              "Non reef coral community",
              "Non-reef Coral community" ,
              "Fringing/Patch/Non-reef coral community",
              "Fringing/Patch/Non-reef",
              "Fringing/Non-reef coral community",
              "Coralline algae/Vermetid reef",
              "Patch Reef/Non-reef coral community",
              "Fringing/Patch/Non-reef",
              "Fringing/Parch Reef/Non-reef Coral community",
              "Fringing/Patch reefs/non-reef coral community",
              "Barrier/Fringing/Non-reef coral community"
              )

data <- data %>% filter(!REEF_TYPE %in% remove)

#reduce to coordinate data
pts <- data[,c("LON", "LAT")]
#remove data points without coordinates
pts <- na.omit(pts)

plot(pts)

r <- raster(res = res)
#rasterize points
ras <- rasterize(x = pts, y = r, field = 1) 
#plot raster
plot(ras)
#spatial subsample
pts_ras <- rasterToPoints(ras)
pts_ras <- data.frame(pts_ras[,c("x","y")])
pts_ras$species <- "reef"
pts_ras <- pts_ras[,c("species", "x", "y")]

#plot points
plot(pts_ras[,2:3])
#save data
write.csv(pts_ras, "./data/occurrences/ReefBase_pts_subsample.csv", row.names = FALSE)
writeRaster(ras, "./data/occurrences/ReefBase_raster.asc", overwrite = TRUE)

beepr::beep(2)


